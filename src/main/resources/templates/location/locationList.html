<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="/calendar/css/style.css">
    <link rel="stylesheet" href="/calendar/css/default.css">
    <link rel="stylesheet" href="/calendar/css/modal.css">
    <link rel="stylesheet" href="/calendar/css/memo.css">
    <link rel="stylesheet" href="/calendar/css/notifications.css">
<title>ì¥ì†Œ ë¦¬ìŠ¤íŠ¸</title>
<!-- ì¹´ì¹´ì˜¤ë§µ API -->
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=278940b595d1bf12680c71409de85eda&libraries=services"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
#map { width: 100%; height: 400px; }
#search-bar { margin: 10px 0; text-align: right;}
#places-list { margin-top: 20px; }
.searchLocation {
	display: flex;
    align-items: center; /* ì„¸ë¡œ ì •ë ¬ ì¤‘ì•™ */
    gap: 10px; /* ìš”ì†Œ ê°„ ê°„ê²© */
    flex-wrap: wrap; /* ìš”ì†Œê°€ í™”ë©´ì— ë§ê²Œ ì¤„ë°”ê¿ˆ */
    margin: 10px 0;
}
.searchLocation .locationbuttons {
    margin-right: auto; /* ë²„íŠ¼ë“¤ì„ ì˜¤ë¥¸ìª½ ì •ë ¬ */
}
.place-item {
    border: 1px solid #ddd;
    padding: 10px;
    margin-bottom: 5px;      
}
.popup {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ë°°ê²½ */
	display: flex;
	justify-content: center;
	align-items: center;
	z-index: 1000;
}
.popup.hidden {
   display: none; /* ìˆ¨ê¸°ê¸° */
}
.popup-content {
   background: #fff;
   padding: 20px;
   border-radius: 8px;
   max-width: 400px;
   width: 100%;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
   text-align: center;
   position: relative;
}
.popup-content .close-btn {
   position: absolute;
   top: 10px;
   right: 10px;
   background: none; /* ë°°ê²½ ì œê±° */
   border: none; /* í…Œë‘ë¦¬ ì œê±° */
   font-size: 18px;
   font-weight: bold; /* í°íŠ¸ êµµê¸° */
   cursor: pointer;
   color: #333; /* ë‹«ê¸° ë²„íŠ¼ ìƒ‰ìƒ */
}
#popup-title {
   font-size: 20px;
   font-weight: bold;
   margin-bottom: 10px;
}
#popup-address, #popup-phone {
   margin-bottom: 10px;
   font-size: 14px;
   color: #555;
}
#popup-route button {
	background-color: #007bff;
	color: white;
	border: none;
	padding: 10px 20px;
	border-radius: 5px;
	cursor: pointer;
}
#popup-route button:hover {
      background-color: #0056b3;
}	
.location-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 0;
    margin: 0;
}
.location-item {
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 5px;
    background-color: #f9f9f9;
}
.location-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
}
.location-title {
    font-size: 20px;
    color: #333;
    text-decoration: none;
}
.location-title:hover {
    text-decoration: underline;
}
.location-info {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    font-size: 14px;
    color: #555;
}
.location-category,
.location-author,
.location-review-count,
.location-rating,
.location-address{
    margin-right: 10px;
}
.location-distance{
	margin-left : auto;
}

.rating-icon{
	color: #FF69B4;
	margin-right: 5px;
}
.review-count-icon {
	color: #4CAF50;
	margin-right: 5px;
}
.author-icon {
	color: #007bff;
	margin-right: 5px;
}
.category-icon {
	margin-right: 5px;
}
.button-group {
    display: flex;
    gap: 10px; /* ë²„íŠ¼ ê°„ê²© */
}
.edit-btn, .delete-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
    color: #007bff; /* íŒŒë€ìƒ‰ ì•„ì´ì½˜ */
    transition: color 0.3s;
}
.delete-btn {
    color: #dc3545; /* ë¹¨ê°„ìƒ‰ ì•„ì´ì½˜ */
}
.edit-btn:hover {
    color: #0056b3;
}
.delete-btn:hover {
    color: #c82333;
}

/* ì „ì²´ í˜ì´ì§€ë¥¼ ê°ì‹¸ëŠ” í•˜ì–€ ë°°ê²½ */
.centered-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* í™”ë©´ ì „ì²´ ë†’ì´ */
    background-color: #f0f0f0; /* í˜ì´ì§€ ë°°ê²½ìƒ‰ (ë°ì€ íšŒìƒ‰) */
    padding: 20px;
    box-sizing: border-box;
}

/* ì½˜í…ì¸  ì˜ì—­ */
.white-background {
    background-color: #ffffff; /* í•˜ì–€ ë°°ê²½ */
    border-radius: 10px; /* ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    max-width: 1200px; /* ìµœëŒ€ ë„ˆë¹„ */
    width: 100%; /* í™”ë©´ì— ê½‰ ì°¨ë„ë¡ ì„¤ì • */
    padding: 20px; /* ë‚´ë¶€ ì—¬ë°± */
    box-sizing: border-box; /* ë°•ìŠ¤ í¬ê¸° í¬í•¨ */
}

.help-icon-container {
    position: fixed;
    top: 20%;
    right: 20px;
    z-index: 1000;
}

.help-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #007bff;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 20px;
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease-in-out;
}

.help-icon:hover {
    transform: scale(1.1);
}

.help-balloon {
    position: fixed;
    top: 20%;
    right: 80px;
    background-color: #ffffff;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    width: 500px;
    padding: 15px;
    z-index: 1001;
}

.help-balloon.hidden {
    display: none;
}

.help-balloon .close-help {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    color: #333;
}

.help-balloon #helpContent {
    font-size: 14px;
    color: #555;
}
.hidden {
    display: none;
}
</style>
</head>

<body>
<div class="wrapper">
		<!--wrapper : ì „ì²´ í˜ì´ì§€ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ-->
		<!-- Sidebar -->
		<nav class="sidebar" th:replace="~{profile}"></nav>

		<!-- Content Wrapper -->
		<!--Content Wrapper : ë©”ì¸ ì½˜í…ì¸ ì™€ ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ -->
		 <div class="content-wrapper">
            <!-- Navbar -->
            <nav class="navbar">
                <div class="navbar-container">
                    <a href="#" class="navbar-logo">ã‚‚ãµã‚‚ãµ</a>
                    <ul class="navbar-menu">
                        <li><a href="#home">í™ˆ</a></li>
                        <li><a href="#services">í”¼ë“œ</a></li>
                        <li><a href="#about">ê²Œì‹œíŒ</a></li>
                        <li><a href="/location/locationList">ì¥ì†Œì¶”ì²œ</a></li>
                    </ul>
                    <div class="navbar-icons">
                        <div class="icon-group">
                            <div class="noti_icon-item" onclick="openNotificationModal()">
                                <i class="fas fa-bell"></i>
                                ì•ŒëŒ <span id="notification-count" class="noti_badge" style="display: none;">0</span>
                            </div>
                        </div>
                        <div class="profile-group">
                            <span class="divider"></span>
                            <span class="profile-name">ë‹‰ë„¤ì„: <span th:text="${nickname}"></span></span>
                            <button id="logoutButton" onclick="window.location.href='/user/logout'">ë¡œê·¸ì•„ì›ƒ</button>
                            <!-- ê´€ë¦¬ì í˜ì´ì§€ ë²„íŠ¼ -->
                            <button id="adminButton" style="display: none;" onclick="window.location.href='/admin/adminpage'">ê´€ë¦¬ì í˜ì´ì§€</button>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
                <div id="noti_modal" class="noti_modal">
                    <div class="noti_modal-content">
                        <span class="noti_close-button" onclick="closeNotificationModal()">&times;</span>
                        <h3>í˜„ì¬ ì˜ˆì •ëœ ì¼ì •</h3>
                        <ul id="notification-list"></ul>
                    </div>
                </div>
			
<div class="centered-container">
<div class="white-background">			
<h1>ì¥ì†Œ ì¶”ì²œ</h1>
<div id="search-bar">
    <input type="text" id="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
    <button onclick="searchPlaces()"><i class="fas fa-search"></i></button>
</div>
<div id="map">
	<!-- ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
    <div id="mapControls" style="position:absolute; top:10px; left:10px; z-index:1000;">
    <button onclick="setOverlayMapTypeId('traffic')" style="margin-bottom:5px; padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        êµí†µì •ë³´
    </button>
    <button onclick="setOverlayMapTypeId('terrain')" style="margin-bottom:5px; padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        ì§€í˜•ì •ë³´
    </button>
    <button onclick="setOverlayMapTypeId('bicycle')" style="margin-bottom:5px; padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        ìì „ê±° ë„ë¡œ
    </button>
    <button onclick="resetMap()" style="padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        ì´ˆê¸°í™”
    </button>
</div>
</div>
<div id="places-list"></div>
<script>
// ì§€ë„ ì´ˆê¸°í™”
var mapContainer = document.getElementById('map'); // ì§€ë„ë¥¼ í‘œì‹œí•  div
var mapOption = {
    center: new kakao.maps.LatLng(35.1059, 129.0377), // ì´ˆê¸° ì¤‘ì‹¬ ì¢Œí‘œ
    level: 4 // ì§€ë„ í™•ëŒ€ ë ˆë²¨
};
//ì§€ë„ ìƒì„±
var map = new kakao.maps.Map(mapContainer, mapOption);
// ì¥ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ ê°ì²´ ìƒì„±
var ps = new kakao.maps.services.Places();
var markers = []; // ë§ˆì»¤ ë°°ì—´
var currentInfoWindow = null; // í˜„ì¬ ì—´ë ¤ ìˆëŠ” ì¸í¬ìœˆë„ìš°ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 }); // ì¸í¬ìœˆë„ìš° ê°ì²´ ìƒì„±
// ì¥ì†Œ ê²€ìƒ‰ í•¨ìˆ˜
function searchPlaces() {
	var keyword = document.getElementById('keyword').value;
	
	if (!keyword) {
	    alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
	    return;
	}
	// ì¥ì†Œ ê²€ìƒ‰
	ps.keywordSearch(keyword, placesSearchCB);
}
// ì¥ì†Œ ê²€ìƒ‰ ì½œë°± í•¨ìˆ˜
function placesSearchCB(data, status, pagination) {
    if (status === kakao.maps.services.Status.OK) {
        // ê²€ìƒ‰ëœ ì¥ì†Œ ë§ˆì»¤ì™€ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
        displayPlaces(data);
    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
        alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
    } else {
        alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}	
// ê²€ìƒ‰ëœ ì¥ì†Œ ë§ˆì»¤ì™€ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ í•¨ìˆ˜
function displayPlaces(places) {
    // ì´ì „ ë§ˆì»¤ ë° ì¸í¬ìœˆë„ìš° ì œê±°
    removeMarkers();

    var bounds = new kakao.maps.LatLngBounds(); // ì§€ë„ ë²”ìœ„ ê°ì²´
    var placesList = document.getElementById('places-list');
    placesList.innerHTML = ''; // ì´ì „ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

    places.forEach(function(place, index) {
        // ë§ˆì»¤ ìƒì„± ë° ì§€ë„ì— í‘œì‹œ
        var markerPosition = new kakao.maps.LatLng(place.y, place.x);
        var marker = new kakao.maps.Marker({
            position: markerPosition,
            map: map
        });
        // ë§ˆì»¤ ë°°ì—´ì— ì¶”ê°€
        markers.push(marker);

        // ì§€ë„ ë²”ìœ„ í™•ì¥
        bounds.extend(markerPosition);
        
     	// ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
        kakao.maps.event.addListener(marker, 'click', function() {
        	// ê¸°ì¡´ì— ì—´ë ¤ ìˆë˜ ì¸í¬ìœˆë„ìš° ë‹«ê¸°
            if (currentInfoWindow) {
                currentInfoWindow.close();
            }
            // ìƒˆë¡œìš´ ì¸í¬ìœˆë„ìš° ìƒì„± ë° ì—´ê¸°
            var infowindowContent = `
                <div style="padding:5px; font-size:12px;">
                    ${place.place_name}<br>
                    ${place.road_address_name || place.address_name}<br>
                    <button onclick="openRoute(${place.y}, ${place.x}, '${place.place_name}')">ê¸¸ì°¾ê¸°</button>
                </div>
            `;
            var infowindow = new kakao.maps.InfoWindow({
                content: infowindowContent
            });
            infowindow.open(map, marker);

            // í˜„ì¬ ì—´ë ¤ ìˆëŠ” ì¸í¬ìœˆë„ìš° ì—…ë°ì´íŠ¸
            currentInfoWindow = infowindow;
        });

// ë¦¬ìŠ¤íŠ¸ì— ì¥ì†Œ ì¶”ê°€
var listItem = document.createElement('div');
listItem.className = 'place-item';
listItem.innerHTML = `
    <strong>${place.place_name}</strong><br>
    ${place.road_address_name || place.address_name}<br>
    ${place.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'}
`;
// ì• ë‹ˆë©”ì´ì…˜ ì ìš©
setTimeout(() => {
    listItem.classList.add('show');
}, index * 100);

//ë¦¬ìŠ¤íŠ¸ í•­ëª© í´ë¦­ ì´ë²¤íŠ¸
listItem.onclick = function() {
	openPopup(place); // íŒì—…ë„ìš°ê¸°
	map.setLevel(4); // í™•ëŒ€ ë ˆë²¨
    map.setCenter(markerPosition); // í´ë¦­í•œ ì¥ì†Œë¡œ ì§€ë„ ì¤‘ì‹¬ ì´ë™
 	// ê¸°ì¡´ì— ì—´ë ¤ ìˆë˜ ì¸í¬ìœˆë„ìš° ë‹«ê¸°
    if (currentInfoWindow) {
        currentInfoWindow.close();
    }

// ìƒˆë¡œìš´ ì¸í¬ìœˆë„ìš° ìƒì„± ë° ì—´ê¸°
var infowindowContent = `
    <div style="padding:5px; font-size:12px;">
        ${place.place_name}<br>
        ${place.road_address_name || place.address_name}<br>
        <button onclick="openRoute(${place.y}, ${place.x}, '${place.place_name}')">ê¸¸ì°¾ê¸°</button>
    </div>
`;
var infowindow = new kakao.maps.InfoWindow({
    content: infowindowContent
});
infowindow.open(map, marker);

// í˜„ì¬ ì—´ë ¤ ìˆëŠ” ì¸í¬ìœˆë„ìš° ì—…ë°ì´íŠ¸
currentInfoWindow = infowindow;
};

placesList.appendChild(listItem);
});

// ì§€ë„ ë²”ìœ„ë¥¼ ê²€ìƒ‰ëœ ì¥ì†Œì— ë§ê²Œ ì¡°ì •
map.setBounds(bounds);
}

// ê¸°ì¡´ ë§ˆì»¤ ë° ìœˆí¬ìœˆë„ìš° ì œê±° í•¨ìˆ˜
function removeMarkers() {
    markers.forEach(function(marker) {
        marker.setMap(null); //ì§€ë„ì—ì„œ ë§ˆì»¤ ì œê±°
    });
    markers = []; //ë§ˆì»¤ë°°ì—´ ì´ˆê¸°í™”
 	// ì—´ë ¤ ìˆëŠ” ì¸í¬ìœˆë„ìš° ë‹«ê¸°
    if (currentInfoWindow) {
        currentInfoWindow.close();
        currentInfoWindow = null; // ë³€ìˆ˜ ì´ˆê¸°í™”
    }
}
// ê¸¸ì°¾ê¸° URL ì—´ê¸° í•¨ìˆ˜
function openRoute(lat, lng, placeName) {
var routeUrl = `https://map.kakao.com/link/to/${encodeURIComponent(placeName)},${lat},${lng}`;
window.open(routeUrl, '_blank'); // ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
}

// íŒì—… ì—´ê¸° í•¨ìˆ˜
function openPopup(place) {
    document.getElementById('popup-title').innerText = place.place_name;
    document.getElementById('popup-address').innerText = `ì£¼ì†Œ: ${place.road_address_name || place.address_name}`;
    document.getElementById('popup-phone').innerText = `ì „í™”ë²ˆí˜¸: ${place.phone || 'ì •ë³´ ì—†ìŒ'}`;
    document.getElementById('popup-route-btn').onclick = function () {
        openRoute(place.y, place.x, place.place_name);
    };
    document.getElementById('popup').classList.remove('hidden');
}
// íŒì—… ë‹«ê¸° í•¨ìˆ˜
function closePopup() {
    document.getElementById('popup').classList.add('hidden');
}
// íŒì—… ê¸¸ì°¾ê¸° í•¨ìˆ˜
function openRoute(lat, lng, placeName) {
    var routeUrl = `https://map.kakao.com/link/to/${encodeURIComponent(placeName)},${lat},${lng}`;
    window.open(routeUrl, '_blank');
}
//ì§€ë„, ìœ„ì„±, í™•ëŒ€ë°”
var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
mapOption = { 
    center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
    level: 5 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
};

var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

//ì¼ë°˜ ì§€ë„ì™€ ìŠ¤ì¹´ì´ë·°ë¡œ ì§€ë„ íƒ€ì…ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
var mapTypeControl = new kakao.maps.MapTypeControl();

//ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
//kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

//ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
var zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

//ì§€ë„ êµí†µì •ë³´, ì§€í˜•ì •ë³´
// ì§€ë„ì— ì¶”ê°€ëœ ì§€ë„íƒ€ì…ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì„ ë³€ìˆ˜ì…ë‹ˆë‹¤
var currentTypeId;
// ë²„íŠ¼ì´ í´ë¦­ë˜ë©´ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function setOverlayMapTypeId(maptype) {
    var changeMaptype;  
    // maptypeì— ë”°ë¼ ì§€ë„ì— ì¶”ê°€í•  ì§€ë„íƒ€ì…ì„ ê²°ì •í•©ë‹ˆë‹¤
    if (maptype === 'traffic') {            
        changeMaptype = kakao.maps.MapTypeId.TRAFFIC;     
    } else if (maptype === 'terrain') {
        changeMaptype = kakao.maps.MapTypeId.TERRAIN;    
    } else if (maptype === 'bicycle') {
        changeMaptype = kakao.maps.MapTypeId.BICYCLE;    
    }
    // ì´ë¯¸ ë“±ë¡ëœ ì§€ë„ íƒ€ì…ì´ ìˆìœ¼ë©´ ì œê±°í•©ë‹ˆë‹¤
    if (currentTypeId) {
        map.removeOverlayMapTypeId(currentTypeId);    
    }
    
    // maptypeì— í•´ë‹¹í•˜ëŠ” ì§€ë„íƒ€ì…ì„ ì§€ë„ì— ì¶”ê°€í•©ë‹ˆë‹¤
    map.addOverlayMapTypeId(changeMaptype);
    
    // ì§€ë„ì— ì¶”ê°€ëœ íƒ€ì…ì •ë³´ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤
    currentTypeId = changeMaptype;        
}
//ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜
function resetMap() {
    if (currentTypeId) {
        map.removeOverlayMapTypeId(currentTypeId); // ì§€ë„ íƒ€ì… ì œê±°
        currentTypeId = null; // ìƒíƒœ ì´ˆê¸°í™”
    }
}
</script>
<!-- ê²€ìƒ‰ í•„í„° ì„ íƒ ì˜ì—­ -->
<form method="get" action="/location/locationList" style="text-align: right;">
<!-- ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ ì„œë²„ë¡œ ì „ì†¡ -->
<input type="hidden" id="userLat" name="userLat" value="">
<input type="hidden" id="userLng" name="userLng" value="">

<div class="searchLocation"> 
<div class="locationbuttons">
    <input type="button" value="ì¥ì†Œì“°ê¸°" onclick="window.open('/location/locationwrite', 'popup', 'width=890,height=400')">
    <input type="button" onclick="location.href='/calendar'" value="ë©”ì¸ìœ¼ë¡œ">
</div>
<!-- ì§€ì—­ í•„í„° ì¶”ê°€ -->
<label for="region">ì§€ì—­:</label>
<select id="region" name="region">
	<option value="ALL" th:selected="${selectedRegion == 'ALL'}">ì „ì²´</option>
	<option value="SEOUL" th:selected="${selectedRegion == 'SEOUL'}">ì„œìš¸</option>
	<option value="BUSAN" th:selected="${selectedRegion == 'BUSAN'}">ë¶€ì‚°</option>
	<option value="DAEGU" th:selected="${selectedRegion == 'DAEGU'}">ëŒ€êµ¬</option>
	<option value="INCHEON" th:selected="${selectedRegion == 'INCHEON'}">ì¸ì²œ</option>
	<option value="GWANGJU" th:selected="${selectedRegion == 'GWANGJU'}">ê´‘ì£¼</option>
	<option value="DAEJEON" th:selected="${selectedRegion == 'DAEJEON'}">ëŒ€ì „</option>
	<option value="ULSAN" th:selected="${selectedRegion == 'ULSAN'}">ìš¸ì‚°</option>
	<option value="SEJONG" th:selected="${selectedRegion == 'SEJONG'}">ì„¸ì¢…</option>
	<option value="GYEONGGI" th:selected="${selectedRegion == 'GYEONGGI'}">ê²½ê¸°</option>
	<option value="GANGWON" th:selected="${selectedRegion == 'GANGWON'}">ê°•ì›</option>
	<option value="CHUNGBUK" th:selected="${selectedRegion == 'CHUNGBUK'}">ì¶©ë¶</option>
	<option value="CHUNGNAM" th:selected="${selectedRegion == 'CHUNGNAM'}">ì¶©ë‚¨</option>
	<option value="JEONBUK" th:selected="${selectedRegion == 'JEONBUK'}">ì „ë¶</option>
	<option value="JEONNAM" th:selected="${selectedRegion == 'JEONNAM'}">ì „ë‚¨</option>
	<option value="GYEONGBUK" th:selected="${selectedRegion == 'GYEONGBUK'}">ê²½ë¶</option>
	<option value="GYEONGNAM" th:selected="${selectedRegion == 'GYEONGNAM'}">ê²½ë‚¨</option>
	<option value="JEJU" th:selected="${selectedRegion == 'JEJU'}">ì œì£¼</option>
</select>
    	
<!-- ì¹´í…Œê³ ë¦¬ í•„í„° ì¶”ê°€ -->
<label for="category">ì¹´í…Œê³ ë¦¬:</label>
<select id="category" name="category">
   	<option value="ALL" th:selected="${selectedCategory == 'ALL'}">ì „ì²´</option>
   	<option value="HOSPITAL" th:selected="${selectedCategory == 'HOSPITAL'}">ğŸ¥ ë³‘ì›</option>
   	<option value="PARK" th:selected="${selectedCategory == 'PARK'}">ğŸï¸ ê³µì›</option>
   	<option value="CAFE" th:selected="${selectedCategory == 'CAFE'}">â˜• ì¹´í˜</option>
   	<option value="KINDERGARTEN" th:selected="${selectedCategory == 'KINDERGARTEN'}">ğŸ  ìœ ì¹˜ì›</option>
   	<option value="PETSHOP" th:selected="${selectedCategory == 'PETSHOP'}">ğŸ›’ ì• ê²¬ìƒµ</option>
   	<option value="OTHERS" th:selected="${selectedCategory == 'OTHERS'}">ğŸ·ï¸ ê¸°íƒ€</option>
</select>
<label for="filter">ì •ë ¬ ê¸°ì¤€:</label>
<select id="filter" name="filter">
    <option value="default" th:selected="${selectedFilter == 'default'}">ê¸°ë³¸</option>
    <option value="reviewCount" th:selected="${selectedFilter == 'reviewCount'}">ë¦¬ë·° ë§ì€ ìˆœ</option>
    <option value="rating" th:selected="${selectedFilter == 'rating'}">í‰ì  ë†’ì€ ìˆœ</option>
	<option value="distance" th:selected="${selectedFilter == 'distance'}">ê°€ê¹Œìš´ ìˆœ</option>
	<option value="myLocations" th:selected="${selectedFilter == 'myLocations'}">ë‚´ê°€ ì“´ ì¶”ì²œê¸€</option>
</select>
<input type="text" id="search" name="search" placeholder="ì¥ì†Œ ì´ë¦„ ê²€ìƒ‰" th:value="${search}">
<button type="submit"><i class="fas fa-search"></i></button>
</form>
</div>

<div th:if="${isEmpty}">
	<p style="color : #555; font-size : 16px; text-align : center;">
	ì„ íƒí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì¶”ì²œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.
	</p>
	<p style="color : #555; font-size : 16px; text-align : center;">
		ì²« ì¶”ì²œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!
	</p>
</div> 
<p>
<div class="location-list">
<div class="location-item" th:each="location, iterStat : ${list}" th:classappend="${iterStat.index >= 5} ? 'hidden' : ''">
<div class="location-header">
	<!-- ì¥ì†Œ ì´ë¦„ -->
    <a class="location-title" th:href="@{/location/locationRead(id=${location.locationId})}" th:text="${location.locationName}"></a>
	<!-- ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼ -->
	<div class="button-group">
  		<button class="edit-btn" th:if="${sessionUser.userId == location.user.userId}"
         		 th:onclick="window.open('/location/locationUpdate?id=[[${location.locationId}]]', 'popup', 'width=890,height=400')">
      	<i class="fa fa-edit"></i>
  		</button>
  		<button class="delete-btn" th:if="${sessionUser.userId == location.user.userId}"
         		 th:onclick="|confirmAction('@{/location/locationDelete(id=${location.locationId})}', 'ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')|">
      	<i class="fa fa-trash"></i>
  		</button>
	</div>	
</div>     	
<div class="location-info">
    <span class="location-category">
        <span th:switch="${location.locationCategory.name()}">
			<span th:case="'HOSPITAL'" style="color:#dc3545;">ğŸ¥</span>
			<span th:case="'PARK'" style="color:#28a745;">ğŸï¸</span>
			<span th:case="'CAFE'" style="color:#6f4e37;">â˜•</span>
			<span th:case="'KINDERGARTEN'" style="color:#f39c12;">ğŸ </span>
			<span th:case="'PETSHOP'" style="color:#6a0dad;">ğŸ›’</span>
			<span th:case="*" style="color:#808080;">ğŸ·ï¸</span> <!-- ê¸°ë³¸ ì•„ì´ì½˜ -->
		</span>
         <span th:text="${location.locationCategory.getDescription()}"></span>
     </span>
     <span class="location-author">
     	<i class="fa fa-user author-icon"></i>
		<span th:text="${location.user.name}"></span>   
     </span>
     <span class="location-review-count">
		<i class="fa fa-comment-dots review-count-icon"></i>
		<span th:text="${location.reviewCount}"></span>
     </span>
     <span class="location-rating">
     	<i class="fa fa-paw rating-icon"></i>
     	<span th:text="${#numbers.formatDecimal(location.locationRating, 1, 1)}">0.0</span>
     </span>
     <!-- ì£¼ì†Œ (ì¥ì†Œ ì´ë¦„ ì•„ë˜ ë‘ ë²ˆì§¸ ì¤„) -->
	<span class="location-address">
    	<i class="fa fa-map-marker-alt" style="color:#dc3545;"></i>
    	<span th:text="${location.locationAddress}"></span>
	</span>
	<span class="location-distance">
            <i class="fa fa-location-arrow" style="color: #007bff;"></i>
            <span th:text="'ë‚´ ìœ„ì¹˜ì—ì„œ ì•½ ' + ${#numbers.formatDecimal(location.locationDistance, 1, 1)} + ' km'"></span>
    </span>
</div>   
</div>
</div>
<div style="text-align: center; margin-top: 20px;">
    <button id="loadMoreBtn" style="padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">ë”ë³´ê¸°</button>
</div>
</div>
</div>
<div class="help-icon-container">
    <div class="help-icon" onclick="toggleHelpBalloon()">?</div>
    <div class="help-balloon hidden" id="helpBalloon">
        <span class="close-help" onclick="toggleHelpBalloon()">&times;</span>
        <div id="helpContent">
            <!-- ì—¬ê¸°ì— ë„ì›€ë§ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš” -->
            <p>â€» ì§€ì—­, ì¹´í…Œê³ ë¦¬, ì •ë ¬ê¸°ì¤€, ì¥ì†Œëª… ê²€ìƒ‰ìœ¼ë¡œ ì°¾ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>â€» ëª¨ë“  í•„í„°ë¥¼ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ex) ì¹´í…Œê³ ë¦¬ë§Œ ì„¤ì •í•´ì„œ ê²€ìƒ‰ë„ ê°€ëŠ¥</p>
            <p>â€» ì§€ë„ ì•„ë˜ ì¢Œì¸¡ ìƒë‹¨ì— ì¥ì†Œ ì¶”ì²œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>â€» ì¥ì†Œ ì¶”ì²œ ê¸€ ì‘ì„± ì‹œ, ì¥ì†Œ ì´ë¦„ì— ë”°ë¼ ì£¼ì†ŒëŠ” ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.</p>
            <p>â€» í•˜ë‹¨ì˜ ë”ë³´ê¸°ë¥¼ ëˆ„ë¥´ë©´ ë” ë§ì€ ê²Œì‹œê¸€ë“¤ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>â€» ì¡°ê±´ì— ë§ëŠ” ê²Œì‹œê¸€ì´ ë” ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°, ë”ë³´ê¸°ëŠ” ì‚¬ë¼ì§‘ë‹ˆë‹¤.</p>
            <p>â€» <i class="fa fa-comment-dots review-count-icon"></i>ì€ í•´ë‹¹ ì¥ì†Œì— ëŒ€í•œ ë¦¬ë·° ê°œìˆ˜ì…ë‹ˆë‹¤.</p>
            <p>â€» <i class="fa fa-paw rating-icon"></i>ì€ í•´ë‹¹ ì¥ì†Œì— ëŒ€í•œ í‰ì ë“¤ì˜ í‰ê· ì…ë‹ˆë‹¤.</p>
        </div>
    </div>
</div>

<script>
// ìˆ˜ì • ë° ì‚­ì œ
function confirmAction(url, message) {
    if (confirm(message)) {
        window.location.href = url;
    }
}
//í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
window.onload = function () {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
            	// ì‚¬ìš©ìì˜ ì‹¤ì œ ìœ„ì¹˜
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;

                // ìˆ¨ê²¨ì§„ input ìš”ì†Œì— ì‚¬ìš©ì ìœ„ì¹˜ ê°’ì„ ì„¤ì •í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡
                document.getElementById('userLat').value = userLat;
                document.getElementById('userLng').value = userLng;
             	// ì§€ë„ ì¤‘ì‹¬ì„ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì´ë™
                map.setCenter(new kakao.maps.LatLng(userLat, userLng));
            
            },
            function (error) {
                // ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨
                console.error("ìœ„ì¹˜ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
                alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        );
    } else {
        alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
};
//í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ìœ„ì¹˜ë¥¼ ê°€ì ¸ì™€ ì¥ì†Œì¶”ì²œ ë²„íŠ¼ì— ì¿¼ë¦¬ ì¶”ê°€
document.addEventListener('DOMContentLoaded', function () {
            const recommendLink = document.querySelector('.navbar-menu li a[href="/location/locationList"]');

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;

                        // ì¥ì†Œì¶”ì²œ ë§í¬ í´ë¦­ ì‹œ ì¢Œí‘œ í¬í•¨ URLë¡œ ì´ë™
                        recommendLink.onclick = function (event) {
                            event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë§‰ê¸°
                            location.href = `/location/locationList?userLat=${userLat}&userLng=${userLng}&region=ALL&category=ALL&filter=default`;
                        };
                    },
                    function (error) {
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error);
                        // ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ë©´ ê¸°ë³¸ URLë¡œ ì´ë™
                        recommendLink.onclick = function () {
                            location.href = `/location/locationList`;
                        };
                    }
                );
            } else {
                console.error("ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                recommendLink.onclick = function () {
                    location.href = `/location/locationList`;
                };
            }
        });

//ë„ì›€ë§ ë§í’ì„ 
function toggleHelpBalloon() {
    const helpBalloon = document.getElementById('helpBalloon');
    if (helpBalloon.classList.contains('hidden')) {
        helpBalloon.classList.remove('hidden');
    } else {
        helpBalloon.classList.add('hidden');
    }
}

//ë”ë³´ê¸°
document.addEventListener('DOMContentLoaded', function () {
    let currentIndex = 5; // í˜„ì¬ í‘œì‹œëœ ê²Œì‹œê¸€ì˜ ê°œìˆ˜
    const items = document.querySelectorAll('.location-item'); // ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    const loadMoreBtn = document.getElementById('loadMoreBtn'); // "ë”ë³´ê¸°" ë²„íŠ¼

    // ì´ˆê¸° ìƒíƒœ: ì²« 5ê°œë§Œ í‘œì‹œ
    items.forEach((item, index) => {
        if (index >= currentIndex) {
            item.classList.add('hidden');
        }
    });

    // "ë”ë³´ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    loadMoreBtn.addEventListener('click', function () {
        let hiddenItemsCount = 0;

        // ë‹¤ìŒ 5ê°œ í•­ëª©ì„ í‘œì‹œ
        for (let i = currentIndex; i < currentIndex + 5 && i < items.length; i++) {
            items[i].classList.remove('hidden');
            hiddenItemsCount++;
        }

        // í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
        currentIndex += hiddenItemsCount;

        // ëª¨ë“  í•­ëª©ì´ í‘œì‹œë˜ë©´ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        if (currentIndex >= items.length) {
            loadMoreBtn.style.display = 'none';
        }
    });
});
</script>
        
                <script src="/calendar/js/notifications.js"></script>
       
</body>
</html>