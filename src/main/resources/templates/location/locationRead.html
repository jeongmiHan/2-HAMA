<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¥ì†Œë³´ê¸°</title>
   <link rel="stylesheet" href="/calendar/css/style.css">
    <link rel="stylesheet" href="/calendar/css/default.css">
    <link rel="stylesheet" href="/calendar/css/modal.css">
    <link rel="stylesheet" href="/calendar/css/memo.css">
    <link rel="stylesheet" href="/calendar/css/notifications.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=278940b595d1bf12680c71409de85eda&libraries=services"></script>
<style>
#map {
    width: 100%;
    height: 400px;    
}
.seachReview {
	display: flex;
    align-items: center; /* ì„¸ë¡œ ì •ë ¬ ì¤‘ì•™ */
    gap: 10px; /* ìš”ì†Œ ê°„ ê°„ê²© */
    flex-wrap: wrap; /* ìš”ì†Œê°€ í™”ë©´ì— ë§ê²Œ ì¤„ë°”ê¿ˆ */
    margin: 10px 0;
}
.seachReview .reviewbuttons {
    margin-right: auto; /* ë²„íŠ¼ë“¤ì„ ì˜¤ë¥¸ìª½ ì •ë ¬ */
} 
.location-item {
         border: 1px solid #ddd;
         padding: 10px;
         border-radius: 5px;
         background-color: #f9f9f9;
         margin: 20px auto;
         max-width: 600px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.location-header {
    display: flex;
    justify-content: center;
    margin-bottom: 10px;
}

.location-title {
    font-size: 30px;
    color: #333;
    text-decoration: none;
    text-align: center;
    font-weight: bold;
}

.location-info {
    margin: 5px 0;
    display: flex;
    flex-direction: column; /* ìš”ì†Œë“¤ì„ ì„¸ë¡œë¡œ ì •ë ¬ */
    gap: 10px; /* ìš”ì†Œ ê°„ ê°„ê²© */
}

.location-address {
    font-size: 16px; /* ì£¼ì†Œ í¬ê¸° */
    display: flex; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ê°€ë¡œ ì •ë ¬ */
    align-items: center;
    gap: 5px; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ê°„ê²© */
    justify-content: center;
    margin-bottom: 5px;
}

.location-details {
    display: flex;
    flex-wrap: wrap; /* í™”ë©´ í¬ê¸°ì— ë§ê²Œ ì¤„ë°”ê¿ˆ */
    gap: 30px; /* ìš”ì†Œ ê°„ ê°„ê²© */
    font-size: 14px; /* ì„¸ë¶€ ì •ë³´ ê¸€ê¼´ í¬ê¸° */
    color: #555;
    justify-content: center;
}

.location-details span {
    display: flex;
    align-items: center; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ìˆ˜ì§ ì •ë ¬ */
    gap: 5px; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ê°„ê²© */
}

.rating-icon {
    color: #FF69B4;
    margin-right: 5px;
}

.review-count-icon {
    color: #4CAF50;
    margin-right: 5px;
}

.author-icon {
    color: #007bff;
    margin-right: 5px;
}

.category-icon {
    margin-right: 5px;
}
 
.review-list {
     margin: 0;
     padding: 0;
     list-style-type: none;
 }
 .review-item {
     display: flex; /* ê°€ë¡œ ì •ë ¬ */
     align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
     border: 1px solid #ddd;
     border-radius: 5px;
     padding: 15px;
     margin-bottom: 10px;
     background-color: #f9f9f9;
     box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
     position: relative; /* ë‚ ì§œ ìœ„ì¹˜ë¥¼ ìœ„í•œ ê¸°ì¤€ */
     width: 90%;
 	 height: 120px; /* ì„¸ë¡œ í¬ê¸° ì¡°ì ˆ */
     margin-left: auto;
     margin-right: auto;
 }
  
.review-image {
    flex: 0 0 100px; /* ê³ ì •ëœ í¬ê¸° */
    height: 100px;
    margin-right: 15px;
    background-color: #ffebcd;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative; /* ìƒëŒ€ ìœ„ì¹˜ ì„¤ì • */
}
.review-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.review-content-box {
    flex: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
.review-text {
    margin-bottom: 5px; /* ê°„ê²© ì¤„ì„ */
	color: #444;
	font-size: 0.9em; /* ê¸€ì”¨ í¬ê¸° ì¤„ì„ */
}
.review-author {
    text-align: right;
    font-size: 0.9em;
    color: #555;
}
.review-date {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 0.8em;
    color: #888;
}
.review-rating {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    font-size: 1em;
    margin-bottom: 5px;
}
    
 .rating-icon {
     color: #FF69B4; /* í•‘í¬ìƒ‰ìœ¼ë¡œ ì„¤ì • */
     font-size: 1em; /* ì•„ì´ì½˜ í¬ê¸° */
     margin-right: 5px; /* ìˆ«ì í‰ì ê³¼ì˜ ê°„ê²© */
 }
.no-rating{
	color: gray;
	font-style: italic;
}
/* ì´ë¯¸ì§€ ê°œìˆ˜ í‘œì‹œ ë°°ì§€ */
.image-count {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background-color: rgba(0, 0, 0, 0.7); /* ì–´ë‘ìš´ ë°°ê²½ */
    color: white; /* ê¸€ì”¨ ìƒ‰ìƒ */
    border-radius: 50%; /* ì›í˜• */
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: bold;
}
.modal {
 display: none;
 position: fixed;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
 background: rgba(0, 0, 0, 0.8);
 z-index: 1000;
}

.modal img {
    display: block;
    max-width: 90%;
    max-height: 90%;
    margin: auto;
    border-radius: 10px;
    object-fit: contain; /* ì´ë¯¸ì§€ ì™œê³¡ ë°©ì§€ */
}

.modal .close {
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 30px;
    color: white;
    cursor: pointer;
}

.modal button {
    background: none;
    border: none;
    font-size: 30px;
    color: white;
    cursor: pointer;
    margin: 0 10px;
}
/* ë²„íŠ¼ ì˜ì—­ (ì„¸ë¡œ ë°°ì¹˜ ë° ì¹´ë“œì™€ ê°™ì€ ìƒ‰ìƒ) */
.bookmark-buttons {
    position: absolute; /* ë¦¬ìŠ¤íŠ¸ ì¹´ë“œì™€ ë°€ì°© */
    top: 0;
    right: -45px; 
    display: flex;
    flex-direction: column; /* ì„¸ë¡œ ì •ë ¬ */
    gap: 5px; /* ë²„íŠ¼ ê°„ê²© ì„¤ì • */
    background-color: #f9f9f9; /* ë¶€ë“œëŸ¬ìš´ ë² ì´ì§€ í†¤ */
    border: 1px solid #ddd; /* í…Œë‘ë¦¬ ì¶”ê°€ */
    border-radius: 5px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    padding: 5px; /* ì•ˆìª½ ì—¬ë°± */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ */
}
/* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
.bookmark-buttons button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px; /* í¬ê¸° ì¶•ì†Œ */
    padding: 5px;
    border-radius: 0;
    transition: all 0.3s ease;
}
/* ìˆ˜ì • ë²„íŠ¼ */
.edit-btn {
    color: #007bff; /* íŒŒë€ìƒ‰ */
}

.edit-btn:hover {
    color: #0056b3;
    transform: scale(1.1); /* í˜¸ë²„ ì‹œ í™•ëŒ€ */
}

/* ì‚­ì œ ë²„íŠ¼ */
.delete-btn {
    color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
}

.delete-btn:hover {
    color: #c82333;
    transform: scale(1.1);
}

/* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.fa-edit, .fa-trash {
    font-size: 1.2em;
}
/* ì „ì²´ í˜ì´ì§€ë¥¼ ê°ì‹¸ëŠ” í•˜ì–€ ë°°ê²½ */
.centered-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* í™”ë©´ ì „ì²´ ë†’ì´ */
    background-color: #f0f0f0; /* í˜ì´ì§€ ë°°ê²½ìƒ‰ (ë°ì€ íšŒìƒ‰) */
    padding: 20px;
    box-sizing: border-box;
}

/* ì½˜í…ì¸  ì˜ì—­ */
.white-background {
    background-color: #ffffff; /* í•˜ì–€ ë°°ê²½ */
    border-radius: 10px; /* ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    max-width: 1200px; /* ìµœëŒ€ ë„ˆë¹„ */
    width: 100%; /* í™”ë©´ì— ê½‰ ì°¨ë„ë¡ ì„¤ì • */
    padding: 20px; /* ë‚´ë¶€ ì—¬ë°± */
    box-sizing: border-box; /* ë°•ìŠ¤ í¬ê¸° í¬í•¨ */
}
.visitor-photo-slider {
    width: 100%;
    overflow: hidden; /* ìŠ¬ë¼ì´ë” ì˜ì—­ ì™¸ë¶€ ìˆ¨ê¹€ */
    position: relative;
    height: 150px; /* ì‚¬ì§„ ë†’ì´ ê³ ì • */
    margin-bottom: 20px;
}

.visitor-photo-list {
    display: flex;
    gap: 10px;
    transition: transform 0.5s ease-in-out; /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
}

.visitor-photo-item {
    flex: 0 0 auto; /* ê³ ì • í¬ê¸° */
    width: 130px;
    height: 130px;
    border-radius: 10px;
    background-color: #e9ecef;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out;
}

.visitor-photo-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.visitor-photo-item:hover {
    transform: scale(1.1); /* í˜¸ë²„ ì‹œ í™•ëŒ€ */
}

.help-icon-container {
    position: fixed;
    top: 20%;
    right: 20px;
    z-index: 1000;
}

.help-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #007bff;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 20px;
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease-in-out;
}

.help-icon:hover {
    transform: scale(1.1);
}

.help-balloon {
    position: fixed;
    top: 20%;
    right: 80px;
    background-color: #ffffff;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    width: 450px;
    padding: 15px;
    z-index: 1001;
}

.help-balloon.hidden {
    display: none;
}

.help-balloon .close-help {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    color: #333;
}

.help-balloon #helpContent {
    font-size: 14px;
    color: #555;
}
.hidden {
    display: none;
}
</style>   
</head>

<body>
<div class="wrapper">
		<!--wrapper : ì „ì²´ í˜ì´ì§€ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ-->
		<!-- Sidebar -->
		<nav class="sidebar" th:replace="~{profile}"></nav>
		<!-- Content Wrapper -->
		<!--Content Wrapper : ë©”ì¸ ì½˜í…ì¸ ì™€ ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ -->
		<div class="content-wrapper">
			<!-- Navbar -->
			<!--Navbar: í˜ì´ì§€ ìƒë‹¨ì— ìœ„ì¹˜í•œ ê²€ìƒ‰ì°½ê³¼ ì•Œë¦¼ í”„ë¡œí•„ ë“±-->
			 <nav class="navbar">
                <div class="navbar-container">
                    <a href="#" class="navbar-logo">ã‚‚ãµã‚‚ãµ</a>
                    <ul class="navbar-menu">
                        <li><a href="#home">í™ˆ</a></li>
                        <li><a href="#services">í”¼ë“œ</a></li>
                        <li><a href="#about">ê²Œì‹œíŒ</a></li>
                        <li><a href="/location/locationList">ì¥ì†Œì¶”ì²œ</a></li>
                    </ul>
                    <div class="navbar-icons">
                        <div class="icon-group">
                            <div class="noti_icon-item" onclick="openNotificationModal()">
                                <i class="fas fa-bell"></i>
                                ì•ŒëŒ <span id="notification-count" class="noti_badge" style="display: none;">0</span>
                            </div>
                        </div>
                        <div class="profile-group">
                            <span class="divider"></span>
                            <span class="profile-name">ë‹‰ë„¤ì„: <span th:text="${nickname}"></span></span>
                            <button id="logoutButton" onclick="window.location.href='/user/logout'">ë¡œê·¸ì•„ì›ƒ</button>
                            <!-- ê´€ë¦¬ì í˜ì´ì§€ ë²„íŠ¼ -->
                            <button id="adminButton" style="display: none;" onclick="window.location.href='/admin/adminpage'">ê´€ë¦¬ì í˜ì´ì§€</button>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
                <div id="noti_modal" class="noti_modal">
                    <div class="noti_modal-content">
                        <span class="noti_close-button" onclick="closeNotificationModal()">&times;</span>
                        <h3>í˜„ì¬ ì˜ˆì •ëœ ì¼ì •</h3>
                        <ul id="notification-list"></ul>
                    </div>
                </div>
			
<div class="centered-container">
<div class="white-background">			
<div id="map">
	<!-- ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
    <div id="mapControls" style="position:absolute; top:10px; left:10px; z-index:1000;">
    <button onclick="setOverlayMapTypeId('traffic')" style="margin-bottom:5px; padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        êµí†µì •ë³´
    </button>
    <button onclick="setOverlayMapTypeId('terrain')" style="margin-bottom:5px; padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        ì§€í˜•ì •ë³´
    </button>
    <button onclick="setOverlayMapTypeId('bicycle')" style="margin-bottom:5px; padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        ìì „ê±° ë„ë¡œ
    </button>
    <button onclick="resetMap()" style="padding:8px 12px; font-size:12px; color:black; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        ì´ˆê¸°í™”
    </button>
	</div>
</div>
    <!-- ì¥ì†Œ ì •ë³´ (locationList ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš©) -->
    <div class="location-item">
        <div class="location-header">
            <a class="location-title" th:href="@{/location/locationRead(id=${location.locationId})}" th:text="${location.locationName}"></a>
        </div>

        <div class="location-info">
        	<span class="location-address">
                <i class="fa fa-map-marker-alt" style="color:#dc3545;"></i>
                <span th:text="${location.locationAddress}"></span>
            </span>
        <div class="location-details">
            <span class="location-category">
                <span th:switch="${location.locationCategory.name()}">
                    <span th:case="'HOSPITAL'" style="color:#dc3545;">ğŸ¥</span>
                    <span th:case="'PARK'" style="color:#28a745;">ğŸï¸</span>
                    <span th:case="'CAFE'" style="color:#6f4e37;">â˜•</span>
                    <span th:case="'KINDERGARTEN'" style="color:#f39c12;">ğŸ </span>
                    <span th:case="'PETSHOP'" style="color:#6a0dad;">ğŸ›’</span>
                    <span th:case="*" style="color:#808080;">ğŸ·ï¸</span>
                </span>
                <span th:text="${location.locationCategory.getDescription()}"></span>
            </span>

            <span class="location-author">
                <i class="fa fa-user author-icon"></i>
                <span th:text="${location.user.name}"></span> 
            </span>

            <span class="location-review-count">
                <i class="fa fa-comment-dots review-count-icon"></i>
                <span th:text="${location.reviewCount}"></span>
            </span>

            <span class="location-rating">
                <i class="fa fa-paw rating-icon"></i>
                <span th:text="${#numbers.formatDecimal(location.locationRating, 1, 1)}">0.0</span>
            </span>       
        	</div>
    		</div>
			</div>
 		
<h4>ë°©ë¬¸ì ì‚¬ì§„</h4>
<div class="visitor-photo-slider">
    <div class="visitor-photo-list" id="visitor-photo-list">
        <!-- ë°©ë¬¸ì ì‚¬ì§„ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
    </div>
</div>

<h3>ë¦¬ë·° ëª©ë¡</h3>
<div class="seachReview">
<div class="reviewbuttons">      
	<input type="button" value="ë¦¬ë·° ì“°ê¸°" th:onclick="|window.open('/review/reviewwrite?locationId=' + [[${location.locationId}]], 'popup', 'width=500,height=650')|">
	<input type="button" onclick="location.href='/location/locationList'" value="ëª©ë¡ìœ¼ë¡œ" id="listButton">
</div>
<!-- ê²€ìƒ‰ í•„í„° ì„ íƒ ì˜ì—­ -->
<form method = "get" action = "/location/locationRead" style="text-align: right;">
	<input type="hidden" name="id" th:value="${location.locationId}">
	<label for = "filter">ì •ë ¬ ê¸°ì¤€:</label>
	<select id="filter" name="filter">
		<option value = "default" th:selected="${selectedFilter == 'default'}">ê¸°ë³¸</option>
		<option value = "reviewRating" th:selected="${selectedFilter == 'reviewRating'}">í‰ì  ë†’ì€ ìˆœ</option>
		<option value = "reviewDate" th:selected="${selectedFilter == 'reviewDate'}">ìµœì‹ ìˆœ</option>
		<option value = "myReviews" th:selected="${selectedFilter == 'myReviews'}">ë‚´ê°€ ì“´ ë¦¬ë·°</option>
	</select>
	<button type="submit"><i class="fas fa-search"></i></button>
</form>
</div>

<!-- ë¦¬ë·°ê°€ ë‹¨ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° ë©”ì„¸ì§€ -->
<div th:if="${#lists.isEmpty(listR)}" style="text-align:center; color:#555; margin:20px 0;">
	<p th:text="|${location.locationName}ì˜ ì²« ë¦¬ë·°ë¥¼ ë‹¬ì•„ë³´ì„¸ìš”!|"></p>
</div>

<div class="review-list">
    <div th:each="review, iterStat : ${listR}" class="review-item" th:classappend="${iterStat.index >= 5} ? 'hidden' : ''">
        <!-- ì´ë¯¸ì§€ ì˜ì—­ -->
    <div class="review-image" style="position: relative;">
    <!-- ì´ë¯¸ì§€ ì¡°ê±´ ì²˜ë¦¬ ì¶”ê°€ -->
    <th:block th:if="${review.reviewImagePath != null and review.reviewImagePath != ''}">   
        <img th:src="@{'/uploads/' + ${#strings.arraySplit(review.reviewImagePath, ',')[0].trim()}}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" 
        th:attr="data-images=${review.reviewImagePath}" onclick="openImageModal(this)">
        <!-- ì´ë¯¸ì§€ ê°œìˆ˜ í‘œì‹œ -->
        <span class="image-count" th:text="${#strings.arraySplit(review.reviewImagePath, ',').length}"></span>  
    </th:block>
    <th:block th:if="${review.reviewImagePath == null or review.reviewImagePath == ''}">
        <span>ì²¨ë¶€ì´ë¯¸ì§€ ì—†ìŒ</span>
    </th:block>
	</div>
        <!-- ë‚´ìš© ì˜ì—­ -->
        <div class="review-content-box">
            <div class="review-text">
                <p th:text="${review.reviewContent}">ë¦¬ë·° ë‚´ìš©</p>
            </div>
            <div class="review-rating">
                <i class="fa fa-paw rating-icon"></i>
                <span th:text="${review.reviewRating}">í‰ì </span>
            </div>
            <div class="review-author">
            	<i class="fa fa-user author-icon"></i>
                <span th:text="${review.user.name}">ì‘ì„±ì</span>
            </div>
        </div>
        <!-- ë‚ ì§œ ì˜ì—­ -->
        <span class="review-date" th:text="${review.reviewDate}">ì‘ì„±ì¼</span>
    	
    	<!-- ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ (ì±…ê°ˆí”¼ í˜•íƒœ)-->
        <div class="bookmark-buttons" th:if="${sessionUser.userId == review.user.userId}">
            <button class="edit-btn" th:onclick="window.open('/review/reviewUpdate?reviewId= + [[${review.reviewId}]]', 'popup', 'width=500,height=650')">
                <i class="fa fa-edit"></i>
            </button>
            <button class="delete-btn" th:onclick="|confirmAction('@{/review/reviewDelete(reviewId=${review.reviewId}, locationId=${location.locationId})}', 'ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')|">
    			<i class="fa fa-trash"></i>
			</button>
        </div> 
    </div>
</div>

<!-- ë”ë³´ê¸° ë²„íŠ¼ -->
<div style="text-align: center; margin-top: 20px;">
    <button id="loadMoreReviewsBtn" style="padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">ë”ë³´ê¸°</button>
</div>

</div>
</div>
</div>
<!-- ë¦¬ë·°ì´ë¯¸ì§€ ëª¨ë‹¬ ì°½ ì¶”ê°€ -->
<div id="imageModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000;">
    <span class="close" onclick="closeImageModal()" style="position:absolute; top:10px; right:20px; font-size:30px; color:white; cursor:pointer;">&times;</span>
    <div style="display:flex; align-items:center; justify-content:center; height:100%;">
        <button onclick="prevImage()" style="background:none; border:none; font-size:30px; color:white;">&#10094;</button>
        <img id="modalImage" src="" style="max-width:90%; max-height:90%; border-radius:10px; object-fit:contain;">
        <button onclick="nextImage()" style="background:none; border:none; font-size:30px; color:white;">&#10095;</button>
    </div>
</div>

<!-- ë°©ë¬¸ì ì‚¬ì§„ ëª¨ë‹¬ ì°½ -->
<div id="visitorImageModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000;">
    <span class="close" onclick="closeVisitorImageModal()" style="position:absolute; top:10px; right:20px; font-size:30px; color:white; cursor:pointer;">&times;</span>
    <div style="display:flex; align-items:center; justify-content:center; height:100%;">
        <button onclick="prevVisitorImage()" style="background:none; border:none; font-size:30px; color:white;">&#10094;</button>
        <img id="visitorModalImage" src="" style="max-width:90%; max-height:90%; border-radius:10px; object-fit:contain;">
        <button onclick="nextVisitorImage()" style="background:none; border:none; font-size:30px; color:white;">&#10095;</button>
    </div>
</div>

<div class="help-icon-container">
    <div class="help-icon" onclick="toggleHelpBalloon()">?</div>
    <div class="help-balloon hidden" id="helpBalloon">
        <span class="close-help" onclick="toggleHelpBalloon()">&times;</span>
        <div id="helpContent">
            <!-- ì—¬ê¸°ì— ë„ì›€ë§ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš” -->
            <p>â€» ë‹¤ì–‘í•œ ì •ë ¬ ê¸°ì¤€ìœ¼ë¡œ ë¦¬ë·°ë¥¼ ê°ìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>â€» ë°©ë¬¸ì ì‚¬ì§„ ì•„ë˜ ì¢Œì¸¡ ìƒë‹¨ì— ë¦¬ë·°ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>â€» ë¦¬ë·° ìš°ì¸¡ ìƒë‹¨ì˜ ë‚ ì§œëŠ” "ë°©ë¬¸ë‚ ì§œ"ì…ë‹ˆë‹¤.</p>
            <p>â€» ì •ë ¬ ê¸°ì¤€ì˜ ìµœì‹ ìˆœì€ ë°©ë¬¸ë‚ ì§œê°€ í˜„ì¬ì— ê°€ê¹Œìš´ ìˆœì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
            <p>â€» ê¸¸ì°¾ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
            <p>â€» í•˜ë‹¨ì˜ ë”ë³´ê¸°ë¥¼ ëˆ„ë¥´ë©´ ë” ë§ì€ ë¦¬ë·°ë“¤ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>â€» ë¦¬ë·°ê°€ ë” ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°, ë”ë³´ê¸°ëŠ” ì‚¬ë¼ì§‘ë‹ˆë‹¤.</p>
            <p>â€» <i class="fa fa-comment-dots review-count-icon"></i>ì€ í•´ë‹¹ ì¥ì†Œì— ëŒ€í•œ ë¦¬ë·° ê°œìˆ˜ì…ë‹ˆë‹¤.</p>
            <p>â€» <i class="fa fa-paw rating-icon"></i>ì€ í•´ë‹¹ ì¥ì†Œì— ëŒ€í•œ í‰ì ë“¤ì˜ í‰ê· ì…ë‹ˆë‹¤.<br>(ë¦¬ë·°ì—ì„œëŠ” ê° í‰ì ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.)</p>
        </div>
    </div>
</div>


<script>
//ë¦¬ë·° ì‚¬ì§„ ëª¨ë‹¬
let imagePaths = [];
let currentIndex = 0;

//ëª¨ë‹¬ ì°½ ì—´ê¸°
function openImageModal(imgElement) {
    // data-images ì†ì„±ì—ì„œ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ê°€ì ¸ì˜¤ê¸°
    let paths = imgElement.getAttribute('data-images');
    imagePaths = paths.split(','); // ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ê²½ë¡œë¥¼ ë°°ì—´ë¡œ ë³€í™˜
    currentIndex = 0;

    // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ í‘œì‹œ
    updateModalImage();
    document.getElementById('imageModal').style.display = 'block';
}

// ëª¨ë‹¬ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
function updateModalImage() {
    document.getElementById('modalImage').src = '/uploads/' + imagePaths[currentIndex].trim();
}

// ì´ì „ ì´ë¯¸ì§€ ë³´ê¸°
function prevImage() {
    if (currentIndex > 0) {
        currentIndex--;
        updateModalImage();
    }
}

// ë‹¤ìŒ ì´ë¯¸ì§€ ë³´ê¸°
function nextImage() {
    if (currentIndex < imagePaths.length - 1) {
        currentIndex++;
        updateModalImage();
    }
}

// ëª¨ë‹¬ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
function updateModalImage() {
	let modalImage = document.getElementById('modalImage');
    modalImage.src = '/uploads/' + imagePaths[currentIndex].trim(); // ì ˆëŒ€ê²½ë¡œ ë³´ì¥
}

//ë‹«ê¸°
function closeImageModal() {
    document.getElementById('imageModal').style.display = 'none';
    imagePaths = []; // ì´ë¯¸ì§€ ê²½ë¡œ ì´ˆê¸°í™”
    currentIndex = 0; // ì¸ë±ìŠ¤ ì´ˆê¸°í™”
}
//ìˆ˜ì •, ì‚­ì œ
function confirmAction(url, message) {
    if (confirm(message)) {
        window.location.href = url;
    }
}

//ì¹´ì¹´ì˜¤ ë§µ ì—´ê¸°
var locationLat = [[${location.locationLatitude}]]; // ì¥ì†Œì˜ ìœ„ë„
var locationLng = [[${location.locationLongitude}]]; // ì¥ì†Œì˜ ê²½ë„
var locationName = '[[${location.locationName}]]'; // ì¥ì†Œ ì´ë¦„

// ì§€ë„ ì´ˆê¸°í™”
var mapContainer = document.getElementById('map'); 
var mapOption = {
    center: new kakao.maps.LatLng(locationLat, locationLng), 
    level: 4 
};

var map = new kakao.maps.Map(mapContainer, mapOption);

// ë§ˆì»¤ ìƒì„±
var markerPosition = new kakao.maps.LatLng(locationLat, locationLng); // ì¥ì†Œì˜ ìœ„ì¹˜
var marker = new kakao.maps.Marker({
    position: markerPosition,
});
marker.setMap(map);
//InfoWindow ìƒì„±
var infoWindowContent = `
    <div style="padding:5px; text-align:center;">
        <strong>${locationName}</strong><br>
        <button onclick="openRoute(${locationLat}, ${locationLng}, '${locationName}')">
            ê¸¸ì°¾ê¸°
        </button>
    </div>
`;
var infoWindow = new kakao.maps.InfoWindow({
    content: infoWindowContent, // ë§í’ì„ ì˜ HTML ë‚´ìš©
    removable: true // ë‹«ê¸° ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
});

//InfoWindow ìƒì„± (ë§í’ì„ )
var infoWindowContent = `
    <div style="padding:10px; text-align:center; font-size:14px;">
        <strong>${locationName}</strong><br>
        <button onclick="openRoute(${locationLat}, ${locationLng}, '${locationName}')"
                style="margin-top:5px; padding:5px 10px; background-color:#007bff; color:white; border:none; border-radius:5px; cursor:pointer;">
            ê¸¸ì°¾ê¸°
        </button>
    </div>
`;
var infoWindow = new kakao.maps.InfoWindow({
    content: infoWindowContent, // ë§í’ì„ ì˜ HTML ë‚´ìš©
    removable: false // ë‹«ê¸° ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ (true: ë‹«ê¸° ë²„íŠ¼ í‘œì‹œ, false: ë‹«ê¸° ë²„íŠ¼ ìˆ¨ê¹€)
});

// ì§€ë„ ë¡œë“œ ì‹œ InfoWindow í‘œì‹œ
infoWindow.open(map, marker); // ì§€ë„ì™€ ë§ˆì»¤ì— ë§í’ì„  í‘œì‹œ

// ê¸¸ì°¾ê¸° ë²„íŠ¼ í•¨ìˆ˜
function openRoute(lat, lng, name) {
    var routeUrl = `https://map.kakao.com/link/to/${encodeURIComponent(name)},${lat},${lng}`;
    window.open(routeUrl, '_blank'); // ìƒˆ ì°½ì—ì„œ ê¸¸ì°¾ê¸° í˜ì´ì§€ ì—´ê¸°
}
//ì¤‘ì‹¬ì„ ì¥ì†Œë¡œ ì´ë™
map.setCenter(new kakao.maps.LatLng(locationLat, locationLng));

//ì¼ë°˜ ì§€ë„ì™€ ìŠ¤ì¹´ì´ë·°ë¡œ ì§€ë„ íƒ€ì…ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
var mapTypeControl = new kakao.maps.MapTypeControl();

//ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
//kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

//ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
var zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

//ì§€ë„ êµí†µì •ë³´, ì§€í˜•ì •ë³´
//ì§€ë„ì— ì¶”ê°€ëœ ì§€ë„íƒ€ì…ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì„ ë³€ìˆ˜ì…ë‹ˆë‹¤
var currentTypeId;
//ë²„íŠ¼ì´ í´ë¦­ë˜ë©´ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function setOverlayMapTypeId(maptype) {
 var changeMaptype;  
 // maptypeì— ë”°ë¼ ì§€ë„ì— ì¶”ê°€í•  ì§€ë„íƒ€ì…ì„ ê²°ì •í•©ë‹ˆë‹¤
 if (maptype === 'traffic') {            
     changeMaptype = kakao.maps.MapTypeId.TRAFFIC;     
 } else if (maptype === 'terrain') {
     changeMaptype = kakao.maps.MapTypeId.TERRAIN;    
 } else if (maptype === 'bicycle') {
     changeMaptype = kakao.maps.MapTypeId.BICYCLE;    
 }
 // ì´ë¯¸ ë“±ë¡ëœ ì§€ë„ íƒ€ì…ì´ ìˆìœ¼ë©´ ì œê±°í•©ë‹ˆë‹¤
 if (currentTypeId) {
     map.removeOverlayMapTypeId(currentTypeId);    
 }
 
 // maptypeì— í•´ë‹¹í•˜ëŠ” ì§€ë„íƒ€ì…ì„ ì§€ë„ì— ì¶”ê°€í•©ë‹ˆë‹¤
 map.addOverlayMapTypeId(changeMaptype);
 
 // ì§€ë„ì— ì¶”ê°€ëœ íƒ€ì…ì •ë³´ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤
 currentTypeId = changeMaptype;        
}
//ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜
function resetMap() {
 if (currentTypeId) {
     map.removeOverlayMapTypeId(currentTypeId); // ì§€ë„ íƒ€ì… ì œê±°
     currentTypeId = null; // ìƒíƒœ ì´ˆê¸°í™”
 }
}


//ë°©ë¬¸ì ì‚¬ì§„
document.addEventListener("DOMContentLoaded", () => {
    const visitorPhotoList = document.getElementById("visitor-photo-list");

    let currentIndex = 0; // í˜„ì¬ ì¸ë±ìŠ¤
    let itemWidth = 0; // ìŠ¬ë¼ì´ë” ì•„ì´í…œì˜ ë„ˆë¹„
    let totalItems = 0; // ìŠ¬ë¼ì´ë” ì „ì²´ ì•„ì´í…œ ê°œìˆ˜

    // ë°©ë¬¸ì ì‚¬ì§„ ë¦¬ìŠ¤íŠ¸ ìƒì„±
    const reviewItems = document.querySelectorAll(".review-item");
    reviewItems.forEach((reviewItem) => {
        const reviewImages = reviewItem.querySelector(".review-image img");
        if (reviewImages) {
            const images = reviewImages.getAttribute("data-images").split(",");

            images.forEach((path) => {
                const trimmedPath = path.trim();

                // ë°©ë¬¸ì ì‚¬ì§„ ì•„ì´í…œ ìƒì„±
                const photoItem = document.createElement("div");
                photoItem.classList.add("visitor-photo-item");

                // ì´ë¯¸ì§€ íƒœê·¸ ìƒì„±
                const imgElement = document.createElement("img");
                imgElement.src = `/uploads/${trimmedPath}`;
                imgElement.alt = "ë°©ë¬¸ì ì‚¬ì§„";

                // í´ë¦­ ì´ë²¤íŠ¸: ëª¨ë‹¬ ì°½ ì—´ê¸°
                imgElement.addEventListener("click", () => openImageModal(imgElement));
                
                photoItem.appendChild(imgElement);
                visitorPhotoList.appendChild(photoItem);
            });
        }
    });

    // í´ë¡  ìƒì„±: ì²˜ìŒê³¼ ë ë³µì‚¬
    const items = visitorPhotoList.children;
    totalItems = items.length;
    
 	// 8ê°œ ì´í•˜ì¼ ê²½ìš° ìŠ¬ë¼ì´ë” ì ìš©í•˜ì§€ ì•ŠìŒ
    if (totalItems < 9) {
        return; // ìŠ¬ë¼ì´ë” ê¸°ëŠ¥ ì¢…ë£Œ
    }

    // ì•ë’¤ í´ë¡  ì¶”ê°€
    Array.from(items).forEach((item) => {
        const cloneFirst = item.cloneNode(true);
        visitorPhotoList.appendChild(cloneFirst); // ëì— ì¶”ê°€
    });

    // ì´ˆê¸° ì„¤ì •
    const updateSlider = () => {
        itemWidth = items[0].offsetWidth + 10; // ì•„ì´í…œ ë„ˆë¹„ + ê°„ê²©
        visitorPhotoList.style.transform = `translateX(-${currentIndex * itemWidth}px)`; // ì´ˆê¸° ìœ„ì¹˜ë¡œ ì´ë™
    };
    updateSlider();
    window.addEventListener("resize", updateSlider); // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸

    // ìŠ¬ë¼ì´ë” ì‘ë™
    function startSlider() {
        setInterval(() => {
            currentIndex++;
            visitorPhotoList.style.transition = "transform 0.5s ease-in-out";
            visitorPhotoList.style.transform = `translateX(-${currentIndex * itemWidth}px)`;

            // ë¬´í•œ ë£¨í”„ ì²˜ë¦¬
            setTimeout(() => {
                if (currentIndex >= totalItems) {
                    // ì²« ë²ˆì§¸ë¡œ ë˜ëŒì•„ê°€ê¸°
                    currentIndex = 0;
                    visitorPhotoList.style.transition = "none";
                    visitorPhotoList.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
                }
            }, 500); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ í›„ ë¦¬ì…‹
        }, 3000); // 3ì´ˆ ê°„ê²©
    }

    startSlider();
});
// ë²„íŠ¼ ëˆŒëŸ¬ì„œ ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ê°ˆë•Œ, ìœ„ì¹˜ì •ë³´ ê°€ì ¸ê°€ê²Œ
document.addEventListener('DOMContentLoaded', function () {
            const recommendLink = document.querySelector('.navbar-menu li a[href="/location/locationList"]');

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;

                        // ì¥ì†Œì¶”ì²œ ë§í¬ í´ë¦­ ì‹œ ì¢Œí‘œ í¬í•¨ URLë¡œ ì´ë™
                        recommendLink.onclick = function (event) {
                            event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë§‰ê¸°
                            location.href = `/location/locationList?userLat=${userLat}&userLng=${userLng}&region=ALL&category=ALL&filter=default`;
                        };
                    },
                    function (error) {
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error);
                        // ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ë©´ ê¸°ë³¸ URLë¡œ ì´ë™
                        recommendLink.onclick = function () {
                            location.href = `/location/locationList`;
                        };
                    }
                );
            } else {
                console.error("ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                recommendLink.onclick = function () {
                    location.href = `/location/locationList`;
                };
            }
        });

//ë°©ë¬¸ì ì‚¬ì§„ ëª¨ë‹¬ ê´€ë ¨ ì½”ë“œ
let visitorImagePaths = [];
let visitorCurrentIndex = 0;

// ë°©ë¬¸ì ì‚¬ì§„ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
function openVisitorImageModal(imgElement) {
    const allVisitorImages = document.querySelectorAll('.visitor-photo-item img');
    visitorImagePaths = Array.from(allVisitorImages).map(img => img.src);
    visitorCurrentIndex = Array.from(allVisitorImages).indexOf(imgElement);

    updateVisitorModalImage();
    document.getElementById('visitorImageModal').style.display = 'block';
}

// ë°©ë¬¸ì ì‚¬ì§„ ëª¨ë‹¬ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
function updateVisitorModalImage() {
    const modalImage = document.getElementById('visitorModalImage');
    modalImage.src = visitorImagePaths[visitorCurrentIndex];
}

// ì´ì „ ë°©ë¬¸ì ì‚¬ì§„ ë³´ê¸°
function prevVisitorImage() {
    visitorCurrentIndex = (visitorCurrentIndex > 0) ? visitorCurrentIndex - 1 : visitorImagePaths.length - 1;
    updateVisitorModalImage();
}

// ë‹¤ìŒ ë°©ë¬¸ì ì‚¬ì§„ ë³´ê¸°
function nextVisitorImage() {
    visitorCurrentIndex = (visitorCurrentIndex < visitorImagePaths.length - 1) ? visitorCurrentIndex + 1 : 0;
    updateVisitorModalImage();
}

// ë°©ë¬¸ì ì‚¬ì§„ ëª¨ë‹¬ ë‹«ê¸°
function closeVisitorImageModal() {
    document.getElementById('visitorImageModal').style.display = 'none';
}

// ë°©ë¬¸ì ì‚¬ì§„ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
function initializeVisitorPhotoModal() {
    const visitorImages = document.querySelectorAll('.visitor-photo-item img');
    visitorImages.forEach(img => {
        img.addEventListener('click', () => openVisitorImageModal(img));
    });
}

document.addEventListener('DOMContentLoaded', initializeVisitorPhotoModal);

//ë„ì›€ë§ ë§í’ì„ 
function toggleHelpBalloon() {
    const helpBalloon = document.getElementById('helpBalloon');
    if (helpBalloon.classList.contains('hidden')) {
        helpBalloon.classList.remove('hidden');
    } else {
        helpBalloon.classList.add('hidden');
    }
}

document.addEventListener('DOMContentLoaded', function () {
    const reviews = document.querySelectorAll('.review-item'); // ë¦¬ë·° í•­ëª©
    const loadMoreBtn = document.getElementById('loadMoreReviewsBtn'); // "ë”ë³´ê¸°" ë²„íŠ¼
    let currentIndex = 5; // ì´ˆê¸° í‘œì‹œí•  ë¦¬ë·° ê°œìˆ˜

    // ì´ˆê¸° ìƒíƒœ: ì²« 5ê°œë§Œ í‘œì‹œ
    reviews.forEach((review, index) => {
        if (index >= currentIndex) {
            review.classList.add('hidden');
        }
    });

    // "ë”ë³´ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    loadMoreBtn.addEventListener('click', function () {
        let hiddenCount = 0;

        // ë‹¤ìŒ 5ê°œ í•­ëª©ì„ í‘œì‹œ
        for (let i = currentIndex; i < currentIndex + 5 && i < reviews.length; i++) {
            reviews[i].classList.remove('hidden');
            hiddenCount++;
        }

        // í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
        currentIndex += hiddenCount;

        // ëª¨ë“  ë¦¬ë·°ê°€ í‘œì‹œë˜ë©´ "ë”ë³´ê¸°" ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        if (currentIndex >= reviews.length) {
            loadMoreBtn.style.display = 'none';
        }
    });
});
</script>
<script src="/calendar/js/notifications.js"></script>            
</body>
</html>