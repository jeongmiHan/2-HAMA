<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>리뷰쓰기</title>
<link rel="stylesheet" href="/default.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<script>
//폼 검증
 function validateForm(){
 	const reviewContent = document.querySelector('textarea[name="reviewContent"]').value.trim();
 	const reviewRating = document.getElementById("reviewRating").value;
 	const reviewDate = document.querySelector('input[name=reviewDate]').value.trim();
 	
 	//리뷰 내용 검증
 	if(!reviewContent){
 		alert("리뷰 내용을 입력해주세요.");
 		return false;
 	}
 	
 	//리뷰 평점 검증
 	if(reviewRating === "0"){
 		alert("평점을 선택해주세요.");
 		return false;
 	}
 	
 	//방문 일자 검증
 	if(!reviewDate){
 		alert("방문 일자를 선택해주세요.");
 		return false;
 	}
 	
 	//방문 일자가 미래인지 확인
 	const selectedDate = new Date(reviewDate);
 	const today = new Date();

 	if(selectedDate > today){
 		alert("방문 날짜는 오늘 혹은 과거만 선택할 수 있습니다.")
 		return false;
 	}
 	
 	return true;
 }
 
 // 평점
 document.addEventListener("DOMContentLoaded", function () {
     const stars = document.querySelectorAll(".star");
     const ratingInput = document.getElementById("reviewRating");
     
     stars.forEach((star) => {
         star.addEventListener("click", function () {
             const value = this.getAttribute("data-value");
             ratingInput.value = value; // 평점 값을 히든 필드에 저장
             
             // 모든 아이콘 초기화
             stars.forEach((s) => s.classList.remove("selected"));
             
             // 선택한 아이콘까지 강조
             for (let i = 0; i < value; i++) {
                 stars[i].classList.add("selected");
             }
         });
     });
 });
 </script>
<style>
.star-rating {
    display: inline-flex;
    font-size: 2rem; /* 아이콘 크기 */
    cursor: pointer;
}
.star {
    color: lightgray; /* 기본 색상 */
    margin-right: 5px; /* 아이콘 간 거리 조정 */
    transition: color 0.2s ease-in-out;
}
.star:last-child {
    margin-right: 0; /* 마지막 아이콘은 오른쪽 간격 제거 */
}
.star.selected {
    color: #FF69B4; /* 클릭 시 핑크색 (#FF69B4) */
}
.modal-dialog {
    max-width: 600px;
    margin: 2rem auto;
}

.star-rating {
    display: inline-flex;
    font-size: 1.5rem; /* 아이콘 크기 */
    cursor: pointer;
}

.star {
    color: lightgray; /* 기본 색상 */
    margin-right: 5px;
    transition: color 0.2s ease-in-out;
}

.star.selected {
    color: #FF69B4; /* 선택된 별의 색상 */
}

textarea {
    resize: none;
}

.center {
    text-align: center;
}

.file-upload-info {
    font-size: 0.875rem;
    color: #6c757d;
}
.modal-content {
border-radius: 10px;
box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}
.form-control {
    border-radius: 5px;
}
.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}
.btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}
.modal-header {
	margin-bottom : 15px;
}
</style>
</head>
<body>
<div class="container mt-5">
	<div class="modal-dialog">
		<th:block th:utext="${successScript}"></th:block>
		<div class="modal-content p-4">
		<div class="modal-header">
				<h3 class="modal-title">리뷰 수정</h3>
				<button type="button" class="btn-close" onclick="window.close()"></button>
		</div>
		<div class="modal-body">
			<form th:action="@{/review/reviewUpdate(reviewId=${reviewUpdate.reviewId})}" method="post" th:object="${reviewUpdate}" enctype="multipart/form-data" onsubmit="return validateForm()">
				<input type="hidden" name="locationId" th:value="${locationId}">
				<!-- 장소명 -->
				<div class="mb-3">
                     <label for="locationName" class="form-label">장소</label>
                     <input type="text" class="form-control" id="locationName" name="locationName" th:value="${locationName}" readonly>
                 </div>
                 <!-- 내용 -->
                 <div class="mb-3">
                 	<label for="reviewContent" class="form-label">내용</label>
                    <textarea class="form-control" rows="5" id="reviewContent" name="reviewContent" placeholder="리뷰 내용을 입력하세요" th:field="*{reviewContent}"></textarea>
                 </div>
                 <!-- 평점 -->
                 <div class="mb-3">
                     <label class="form-label">평점</label>
                     <div class="star-rating">
                         <i class="fa fa-paw star" data-value="1"></i>
                         <i class="fa fa-paw star" data-value="2"></i>
                         <i class="fa fa-paw star" data-value="3"></i>
                         <i class="fa fa-paw star" data-value="4"></i>
                         <i class="fa fa-paw star" data-value="5"></i>
                     </div>
                     <input type="hidden" name="reviewRating" id="reviewRating" value="0">
                 </div>
                 <!-- 첨부파일 -->
                 <div class="mb-3">
                     <label for="reviewImagePaths" class="form-label">첨부파일</label>
                     <input type="file" class="form-control" name="reviewImagePaths" id="reviewImagePaths" multiple>
                     <div class="file-upload-info">※Ctrl 키를 누르고 클릭하면 여러 파일을 선택할 수 있습니다.</div>
                 </div>
                 <!-- 방문일자 -->
                 <div class="mb-3">
                     <label for="reviewDate" class="form-label">방문일자</label>
                     <input type="date" class="form-control" id="reviewDate" name="reviewDate" th:field="*{reviewDate}" max="">
                 </div>
                 <!-- 버튼 -->
                 <div class="center">
                     <button type="submit" class="btn btn-primary">수정하기</button>
                     <button type="reset" class="btn btn-secondary">다시쓰기</button>
                     <button type="button" class="btn btn-danger" onclick="window.close()">닫기</button>
                 </div>
			</form>
			</div>
		</div>
	</div>
</div>

</body>
</html>